<%- include("../partials/admin-header.ejs"); %>

<main class="admin-main">
    <div class="order-container">
        <div class="order-header">
            <h2>Order #<%= order.id %></h2>
            <div class="order-meta">
                <p>Order date: <%= order.date %></p>
                <p>Status: <span class="badge badge-<%= order.status %>">
                    <%= order.status %>
                </span></p>
            </div>
        </div>
        
        <div class="products-section">
            <h3>Products</h3>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <% order.products.forEach( product => { %>
                    <tr>
                        <td><%= product.productId %></td>
                        <td><%= product.name %></td>
                        <td><%= product.quantity %></td>
                        <td>$<%= product.price %></td>
                        <td>$<%= product.subtotal %></td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

        <div class="customer-info-and-summary">
            <div class="customer-info">
                <% if (!sameAddress) { %>
                <div class="address-card">
                    <h3>Billing Address</h3>
                    <p><span>Name:</span><%= order.billingAddress.name %></p>
                    <p><span>Address:</span><%= order.billingAddress.street %></p>
                    <p><span>City:</span><%= order.billingAddress.city %></p>
                    <p><span>Postal Code:</span><%= order.billingAddress.postalCode %></p>
                    <p><span>Country:</span><%= order.billingAddress.country %></p>
                </div>
                <% } %>

                <div class="address-card">
                    <h3>Shipping Address</h3>
                    <p><span>Name:</span><%= order.shippingAddress.name %></p>
                    <p><span>Address:</span><%= order.shippingAddress.street %></p>
                    <p><span>City:</span><%= order.shippingAddress.city %></p>
                    <p><span>Postal Code:</span><%= order.shippingAddress.postalCode %></p>
                    <p><span>Country:</span><%= order.shippingAddress.country %></p>
                </div>
            </div>
        </div>

        <div class="order-summary">
            <h4>Order Summary</h4>
            <div class="summary-row">
                <span>Payment Method:</span>
                <span><%= order.payment %></span>
            </div>
            <div class="summary-row">
                <span>Total without VAT:</span>
                <span>
                    <% const withoutVAT = order.total * 0.81 %>
                    $<%= withoutVAT.toFixed(2) %>
                </span>
            </div>
            <div class="summary-row">
                <span>VAT:</span>
                <span>
                    <% const VAT = order.total * 0.19 %>
                    $<%= VAT.toFixed(2) %>
                </span>
            </div>
            <div class="summary-row total">
                <span>Total:</span>
                <span>$<%= order.total %></span>
            </div>
        </div>

        <form class="status-form" action="/admin/orders/<%= order.id %>?_method=PATCH" method="POST">
            <label for="status">Change order status:</label>
            <select name="status" id="status">
                <% 
                const statuses = [
                    'Processing', 
                    'Shipped', 
                    'Delivered', 
                    'Cancelled',  
                    'Refunded'
                ];
                statuses.forEach(status => {
                %>
                <option 
                    value="<%= status %>" 
                    <%= order.status === status ? 'selected' : '' %>
                >
                    <%= status.charAt(0).toUpperCase() + status.slice(1) %>
                </option>
                <% }) %>
            </select>
            <button type="submit">Update Status</button>
        </form>
    </div>
</main>

<%- include("../partials/admin-footer.ejs"); %>